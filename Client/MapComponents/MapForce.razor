<!--
 * Copyright 2020-2022 Ronald Ossendrijver. All rights reserved.
--->

@using Treachery.Shared;
@inherits MapComponent;

@for (int i = 0; i < Amount; i++)
{
    float movedX = 0.15f * (5 + i);
    float movedY = 0.15f * (7 + i);

    <Image X=@(X - movedX * Skin.Current.FORCETOKEN_RADIUS) Y=@(Y - movedY * Skin.Current.FORCETOKEN_RADIUS) Diameter=@Diameter Src="@ForceURL" 
            ShadowColor="@ShadowColor" ShadowX=@ShadowSize ShadowY=@ShadowSize ShadowBlur=@ShadowBlur
            Popover="@Popover"/>
}

@if (!(Faction == Faction.White && Special))
{
    <MapText ToShow="@Amount.ToString()" X=@(X) Y=@Y Font=@Skin.Current.FORCETOKEN_FONT BorderWidth=@BorderWidth BorderColor=@BorderColor Popover="@Popover"/>
}

@code {

    [Parameter]
    public bool Special { get; set; } = false;

    [Parameter]
    public int Amount { get; set; }

    [Parameter]
    public Faction Faction { get; set; }

    [Parameter]
    public bool Threatened { get; set; } = false;

    [Parameter]
    public bool ShowPopover { get; set; } = true;

    protected override void OnInitialized()
    {
        Diameter = 2 * Skin.Current.FORCETOKEN_RADIUS;
    }

    private string ForceURL => Special ? Skin.Current.GetFactionSpecialForceImageURL(Faction) : Skin.Current.GetFactionForceImageURL(Faction);

    private string Popover => ShowPopover ? string.Format("<img style='float:left' src='{0}' width=100/><h3 style='float:right'>{1}</h3>", ForceURL, Amount) : null;

    private string ShadowColor => Threatened ? "red" : Skin.Current.SHADOW;

    private float ShadowSize => Threatened ? 0.5f : 0.5f;

    private float ShadowBlur => Threatened ? 1f : 0.5f;

    private string BorderColor => Threatened ? "red" : Skin.Current.FORCETOKEN_FONT_BORDERCOLOR;

    private int BorderWidth => Threatened ? 2 * Skin.Current.FORCETOKEN_FONT_BORDERWIDTH : Skin.Current.FORCETOKEN_FONT_BORDERWIDTH;
}
