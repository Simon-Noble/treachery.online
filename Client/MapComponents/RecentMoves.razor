<!--
 * Copyright 2020-2023 Ronald Ossendrijver. All rights reserved.
--->
 
@using Treachery.Shared
@inherits MapComponent


@if (Skin.Current.ShowArrowsForRecentMoves && h.Game.CurrentMainPhase == MainPhase.ShipmentAndMove)
{
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
            width="@(Skin.Current.PlanetRadius * 2)" height="@(Skin.Current.PlanetRadius * 2)" 
            style="position: absolute; left:0px; top:0px; height: 100%; width: 100%;"
            pointer-events="none">

        @foreach (var move in h.Game.RecentMoves)
        {
            foreach (var origin in move.ForceLocations.Keys)
            {
                var path = Map.FindFirstShortestPath(origin, move.To, false, move.Initiator, Game);

                if (path != null && path.Contains(Game.Map.PolarSink)) {

                    Location from = null;
                    foreach (var to in path)
                    {
                        if (from != null && (to == move.To || to.Territory != from.Territory))
                        {
                            <Arrow FillColor="@Skin.Current.FactionColor[move.Initiator]" StrokeColor=@Skin.Current.GetFactionColorTransparant(move.Initiator, "bb")
                                    MarginX="0" MarginY="0" Radius="@(1.2f * Skin.Current.PlanetRadius)" From=@Skin.Current.GetCenter(from) To=@Skin.Current.GetCenter(to) ArrowScale="0.05f" />
                        }

                        if (from == null || to.Territory != from.Territory)
                        {
                            from = to;
                        }
                    }
                }
                else
                {

                    <Arrow FillColor="@Skin.Current.FactionColor[move.Initiator]" StrokeColor=@Skin.Current.GetFactionColorTransparant(move.Initiator, "bb")
                            MarginX="0" MarginY="0" Radius="@(1.2f * Skin.Current.PlanetRadius)" From=@Skin.Current.GetCenter(origin) To=@Skin.Current.GetCenter(move.To) ArrowScale="0.05f" />
                }
            }
        }

    </svg>
}
