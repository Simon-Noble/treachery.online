@using Treachery.Shared
@inherits MapComponent

@{
    if (Skin.Current.ShowArrowsForRecentMoves && h.Game.CurrentMainPhase == MainPhase.ShipmentAndMove)
    {
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
             width="@(@Skin.Current.PlanetRadius * 2)" height="@(@Skin.Current.PlanetRadius * 2)" 
             style="position: absolute; left: 0px; top:0px; height: 100%; width: 100%;"
             pointer-events="none">
            
            @foreach (var move in h.Game.RecentMoves.Where(move => !move.Passed))
            {
                var to = move.To.Center;

                foreach (var from in move.ForceLocations.Keys)
                {
                    var a = CloserTo(from.Center, to, 0.05f);
                    var b = CloserTo(to, from.Center, 0.05f);

                    <Arrow FillColor="@Skin.Current.FactionColor[move.Initiator]" StrokeColor="@Skin.Current.FactionColorTransparant[move.Initiator]"
                            MarginX="0" MarginY="0"
                            Radius="@((int)(1.1 * Skin.Current.PlanetRadius))"
                            From="from.Center" To="to" ArrowScale="0.05f" />

                }
            }

        </svg>
    }
}

@code {

    private static Point CloserTo(Point a, Point b, float percentage)
    {
        return new Point()
        {
            X = a.X + (int)(percentage * (b.X - a.X)),
            Y = a.Y + (int)(percentage * (b.Y - a.Y)),
        };
    }

}